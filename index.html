<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>NUCS Diary – Write</title>

<link href="https://cdn.quilljs.com/1.3.7/quill.snow.css" rel="stylesheet">

<style>
body {
  font-family: Arial, sans-serif;
  max-width: 760px;
  margin: auto;
  padding: 20px;
}

#editor {
  height: 300px;
}

input, button {
  width: 100%;
  padding: 10px;
  margin-top: 10px;
}
</style>
</head>

<body>

<h1>Write a Post</h1>

<input id="title" placeholder="Post title">

<div id="editor"></div>

<input id="ogImage" placeholder="Preview image URL (optional)">

<button onclick="publish()">Publish</button>

<script src="https://cdn.quilljs.com/1.3.7/quill.js"></script>
<script>
const quill = new Quill('#editor', {
  theme: 'snow',
  placeholder: 'Write your post…',
  modules: {
    toolbar: [
      ['bold','italic','underline'],
      [{ header: [1,2,false] }],
      ['link','image'],
      [{ list: 'ordered' }, { list: 'bullet' }],
      ['clean']
    ]
  }
});

async function publish() {
  const content = quill.root.innerHTML.trim();
  const title = document.getElementById('title').value || "NUCS Diary";
  let ogImage = document.getElementById('ogImage').value;

  if (!content || content === "<p><br></p>") {
    alert("Write something first");
    return;
  }

  if (!ogImage) {
    const match = content.match(/<img[^>]+src="([^">]+)"/);
    if (match) ogImage = match[1];
  }

  const res = await fetch("/publish", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ title, content, ogImage })
  });

  const data = await res.json();
  if (data.url) location.href = data.url;
  else alert("Publish failed");
}
</script>

</body>
</html>
